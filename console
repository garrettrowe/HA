[{"id":"c2eb26bc.d76c48","type":"tab","label":"Flow 1"},{"id":"6c1264a5.ba3fd4","type":"sqlitedb","z":"","db":"/home/pi/garages.db"},{"id":"116ed8e1.0cfbdf","type":"websocket-listener","z":"","path":"/ws/socket","wholemsg":"false"},{"id":"a624899b.97c448","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","verifyservercert":false},{"id":"71d99083.b15818","type":"light-scheduler-settings","z":"c2eb26bc.d76c48","name":"my settings","latitude":"32.8110114","longitude":"-116.902835"},{"id":"366f2ae0.02f46e","type":"exec","z":"c2eb26bc.d76c48","command":"augustctl front lock","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":819,"y":87,"wires":[[],[],[]]},{"id":"6815048f.82426c","type":"http in","z":"c2eb26bc.d76c48","name":"","url":"garage","method":"get","upload":false,"swaggerDoc":"","x":99,"y":364,"wires":[["bd5dce79.b749b"]]},{"id":"266e39ea.d0faf6","type":"http request","z":"c2eb26bc.d76c48","name":"","method":"GET","ret":"txt","url":"","tls":"","x":394,"y":445.75,"wires":[["fc9be186.9c84"]]},{"id":"3656a54e.5ea82a","type":"http response","z":"c2eb26bc.d76c48","name":"","statusCode":"","headers":{},"x":855,"y":450.5,"wires":[]},{"id":"fc9be186.9c84","type":"function","z":"c2eb26bc.d76c48","name":"","func":"if (msg.payload == \"white\" || msg.payload == \"img-swap\"){\n    msg.topic = \"UPDATE GARAGES SET STATUS = NOT STATUS where NAME='\" + msg.garage + \"'\";\n    return [msg,null];\n}else{\nmsg.topic = \"SELECT STATUS FROM GARAGES WHERE NAME = '\" + msg.garage + \"'\";\n} \nreturn [null,msg];","outputs":"2","noerr":0,"x":552,"y":446.75,"wires":[["c466281b.6f7178"],["68bc17f9.10db7"]]},{"id":"c466281b.6f7178","type":"sqlite","z":"c2eb26bc.d76c48","mydb":"6c1264a5.ba3fd4","name":"db","x":552.5,"y":412.25,"wires":[["fc9be186.9c84"]]},{"id":"68bc17f9.10db7","type":"sqlite","z":"c2eb26bc.d76c48","mydb":"6c1264a5.ba3fd4","name":"db","x":698,"y":451,"wires":[["3656a54e.5ea82a","bdee4186.0eab48"]]},{"id":"bdee4186.0eab48","type":"function","z":"c2eb26bc.d76c48","name":"","func":"if (msg.payload.length >0)\n    msg.payload = {\"command\":\"toggle\",\"data\":\"{\\\"switch\\\":\\\"\" + msg.garage + \"\\\",\\\"state\\\":\" + msg.payload[0].STATUS + \"}\"}\nelse\n   msg.payload = { \"command\":\"startup\",\"data\":0}\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":500,"wires":[["9e226e7a.870138"]]},{"id":"9e226e7a.870138","type":"websocket out","z":"c2eb26bc.d76c48","name":"","server":"116ed8e1.0cfbdf","client":"","x":860,"y":500,"wires":[]},{"id":"85efcdb8.80a438","type":"sqlite","z":"c2eb26bc.d76c48","mydb":"6c1264a5.ba3fd4","name":"db","x":121,"y":445,"wires":[["cfae8d21.cd0148"]]},{"id":"bd5dce79.b749b","type":"function","z":"c2eb26bc.d76c48","name":"","func":"msg.garage = msg.payload.garage;\nmsg.topic = \"SELECT URL, STATUS FROM GARAGES WHERE NAME = '\" + msg.garage + \"'\";\n\nreturn msg;","outputs":1,"noerr":0,"x":119,"y":404.75,"wires":[["85efcdb8.80a438"]]},{"id":"cfae8d21.cd0148","type":"function","z":"c2eb26bc.d76c48","name":"","func":"if (typeof(msg.arrived) === \"undefined\"){\n    msg.url = msg.payload[0].URL\n    return [msg, null];\n}\nelse{\n    msg.url = msg.payload[0].URL\n    return [null,msg];\n}\n\n","outputs":"2","noerr":0,"x":247,"y":446,"wires":[["266e39ea.d0faf6"],["6fe8b861.5dd108","266e39ea.d0faf6"]]},{"id":"ac7b855f.333ed8","type":"http in","z":"c2eb26bc.d76c48","name":"","url":"gstatus","method":"get","upload":false,"swaggerDoc":"","x":123,"y":503,"wires":[["ac48a0b0.36b72"]]},{"id":"ac48a0b0.36b72","type":"function","z":"c2eb26bc.d76c48","name":"","func":"msg.garage = msg.payload.garage;\n\nreturn msg;","outputs":1,"noerr":0,"x":278,"y":502,"wires":[["fc9be186.9c84"]]},{"id":"8ef00d15.573e58","type":"http request","z":"c2eb26bc.d76c48","name":"Notify Visitor Arrived","method":"POST","ret":"txt","url":"","tls":"","x":721,"y":351.75,"wires":[["c5e08106.ec50f8"]]},{"id":"66090907.312b68","type":"change","z":"c2eb26bc.d76c48","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/json","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":352,"wires":[["8ef00d15.573e58"]]},{"id":"5280fe4a.87c098","type":"http in","z":"c2eb26bc.d76c48","name":"","url":"mode","method":"get","upload":false,"swaggerDoc":"","x":110,"y":560,"wires":[["8baadc06.37d4f8"]]},{"id":"32007a17.18eb8e","type":"sqlite","z":"c2eb26bc.d76c48","mydb":"6c1264a5.ba3fd4","name":"db","x":646,"y":606,"wires":[["1e9201e4.8a3afe","737ae636.65d4b"]]},{"id":"43b6233b.5f5d5c","type":"sqlite","z":"c2eb26bc.d76c48","mydb":"6c1264a5.ba3fd4","name":"db","x":370,"y":539,"wires":[["a60e0310.3613e8","b2b61c94.020958"]]},{"id":"8baadc06.37d4f8","type":"function","z":"c2eb26bc.d76c48","name":"","func":"msg.mode = msg.payload.mode;\nmsg.topic = \"UPDATE MODE SET STATUS = 0 WHERE NAME != '\" + msg.mode + \"';\";\n\nreturn msg;","outputs":1,"noerr":0,"x":252,"y":539,"wires":[["43b6233b.5f5d5c"]]},{"id":"a60e0310.3613e8","type":"function","z":"c2eb26bc.d76c48","name":"","func":"msg.topic = \"SELECT NAME FROM MODE WHERE STATUS = 1;\";\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":607,"wires":[["32007a17.18eb8e"]]},{"id":"1e9201e4.8a3afe","type":"function","z":"c2eb26bc.d76c48","name":"","func":"if (msg.payload.length >0)\n    msg.payload = {\"command\":\"hmode\",\"data\":msg.payload[0].NAME}\nelse\n   msg.payload = { \"command\":\"startup\",\"data\":0}\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":560,"wires":[["9e226e7a.870138"]]},{"id":"518155fc.4fbecc","type":"http in","z":"c2eb26bc.d76c48","name":"","url":"/mstatus","method":"get","upload":false,"swaggerDoc":"","x":110,"y":620,"wires":[["a60e0310.3613e8","d05fd536.3ccb1"]]},{"id":"cee4e9e9.b4974","type":"http in","z":"c2eb26bc.d76c48","name":"","url":"/lightswitch","method":"get","upload":false,"swaggerDoc":"","x":120,"y":680,"wires":[["737ae636.65d4b"]]},{"id":"737ae636.65d4b","type":"http response","z":"c2eb26bc.d76c48","name":"","statusCode":"","headers":{},"x":850,"y":620,"wires":[]},{"id":"aa72be2b.78038","type":"http request","z":"c2eb26bc.d76c48","name":"Lights on","method":"POST","ret":"txt","url":"https://maker.ifttt.com/trigger/LightsOn/with/key/lh_TzivDCQNHuXbc-XuVGChylygY6SZ7XiK_gS1L9KP","tls":"a624899b.97c448","x":833,"y":994,"wires":[[]]},{"id":"614057b0.54761","type":"http request","z":"c2eb26bc.d76c48","name":"Lights Off","method":"POST","ret":"txt","url":"https://maker.ifttt.com/trigger/LightsOff/with/key/lh_TzivDCQNHuXbc-XuVGChylygY6SZ7XiK_gS1L9KP","tls":"a624899b.97c448","x":835,"y":1041.25,"wires":[[]]},{"id":"e1f8d1c2.9ff2","type":"trigger","z":"c2eb26bc.d76c48","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"5","extend":true,"units":"min","reset":"","name":"","x":369,"y":1053,"wires":[["665eefe6.abc6d8"]]},{"id":"68f9caa1.4a19a4","type":"trigger","z":"c2eb26bc.d76c48","op1":"light-only","op2":"","op1type":"str","op2type":"nul","duration":"4","extend":true,"units":"min","reset":"","name":"","x":370,"y":989.25,"wires":[["665eefe6.abc6d8"]]},{"id":"4d0cc462.ae3c04","type":"function","z":"c2eb26bc.d76c48","name":"","func":"\nif (msg.payload == \"ON\"){\n    return [msg, null, null];\n}\n\nif (msg.payload == \"OFF\"){\n    return [null, null, msg];\n}","outputs":"3","noerr":0,"x":686,"y":993,"wires":[["aa72be2b.78038"],[],["614057b0.54761"]]},{"id":"130aaaaa.84b4d5","type":"http in","z":"c2eb26bc.d76c48","name":"","url":"/camhook","method":"post","swaggerDoc":"","x":173,"y":1019.25,"wires":[["68f9caa1.4a19a4","e1f8d1c2.9ff2","b3ad906c.c077d"]]},{"id":"b3ad906c.c077d","type":"http response","z":"c2eb26bc.d76c48","name":"","x":448,"y":1162.75,"wires":[]},{"id":"665eefe6.abc6d8","type":"light-scheduler","z":"c2eb26bc.d76c48","settings":"71d99083.b15818","events":"[]","topic":"","name":"Sun","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":true,"sunElevationThreshold":"-5","sunShowElevationInStatus":true,"outputfreq":"output.statechange","x":568,"y":994,"wires":[["4d0cc462.ae3c04"]]},{"id":"c568490e.71658","type":"http in","z":"c2eb26bc.d76c48","name":"","url":"arrive","method":"get","upload":false,"swaggerDoc":"","x":82,"y":267,"wires":[["bfccb065.caf7f"]]},{"id":"6fe8b861.5dd108","type":"function","z":"c2eb26bc.d76c48","name":"","func":"if (msg.payload.length >0){\n//us\nreturn [msg, null];\n}else {\n    msg.payload = {};\n    msg.payload.value1 = msg.user + \" has arrived at the compound!\";\n    \n    msg.payload = JSON.stringify(msg.payload);\n    msg.url = \"https://maker.ifttt.com/trigger/notification/with/key/lh_TzivDCQNHuXbc-XuVGChylygY6SZ7XiK_gS1L9KP?Value1=hi\";\n\n    return [null, msg];\n}\n","outputs":"2","noerr":0,"x":371,"y":346,"wires":[["578361cb.805228"],["66090907.312b68"]]},{"id":"bfccb065.caf7f","type":"function","z":"c2eb26bc.d76c48","name":"","func":"msg.user = msg.payload.user;\nmsg.garage = \"g\" + msg.payload.user.toLowerCase();\nmsg.arrived = true;\nreturn msg;","outputs":1,"noerr":0,"x":109,"y":320,"wires":[["bd5dce79.b749b"]]},{"id":"578361cb.805228","type":"exec","z":"c2eb26bc.d76c48","command":"augustctl front unlock","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":562,"y":305,"wires":[[],[],[]]},{"id":"3478c9ba.2bd0fe","type":"http in","z":"c2eb26bc.d76c48","name":"","url":"depart","method":"get","upload":false,"swaggerDoc":"","x":87,"y":87,"wires":[["ee2c86f7.8874e8","6862c4a9.e672cc"]]},{"id":"bbcefa1d.9639c","type":"sqlite","z":"c2eb26bc.d76c48","mydb":"6c1264a5.ba3fd4","name":"db","x":365,"y":87,"wires":[["531bf82c.3a9de8"]]},{"id":"ee2c86f7.8874e8","type":"function","z":"c2eb26bc.d76c48","name":"","func":"msg.topic = \"SELECT NAME FROM MODE WHERE STATUS = 1;\";\n\nreturn msg;","outputs":1,"noerr":0,"x":239,"y":87,"wires":[["bbcefa1d.9639c"]]},{"id":"531bf82c.3a9de8","type":"function","z":"c2eb26bc.d76c48","name":"","func":"msg.payload = msg.payload[0].NAME;\nreturn msg;","outputs":1,"noerr":0,"x":488,"y":87.75,"wires":[["52bb2d46.c7d4b4"]]},{"id":"52bb2d46.c7d4b4","type":"switch","z":"c2eb26bc.d76c48","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"away","vt":"str"}],"checkall":"true","outputs":1,"x":608,"y":87.75,"wires":[["366f2ae0.02f46e"]]},{"id":"d05fd536.3ccb1","type":"debug","z":"c2eb26bc.d76c48","name":"","active":true,"console":"false","complete":"false","x":370,"y":719,"wires":[]},{"id":"b2b61c94.020958","type":"function","z":"c2eb26bc.d76c48","name":"","func":"msg.topic = \"UPDATE MODE SET STATUS = NOT STATUS WHERE NAME = '\" + msg.mode + \"';\";\n\nreturn msg;","outputs":1,"noerr":0,"x":248,"y":583,"wires":[["9a8d24dd.fd3288"]]},{"id":"9a8d24dd.fd3288","type":"sqlite","z":"c2eb26bc.d76c48","mydb":"6c1264a5.ba3fd4","name":"db","x":373,"y":582,"wires":[["a60e0310.3613e8"]]},{"id":"c5e08106.ec50f8","type":"http response","z":"c2eb26bc.d76c48","name":"","statusCode":"","headers":{},"x":893,"y":351.5,"wires":[]},{"id":"6862c4a9.e672cc","type":"http response","z":"c2eb26bc.d76c48","name":"","statusCode":"","headers":{},"x":299,"y":127,"wires":[]}]
